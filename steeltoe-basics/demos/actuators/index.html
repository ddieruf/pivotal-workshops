<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.52-DEV" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />
    <title> :: Pivotal Workshop</title>

    
    <link href="/css/nucleus.css?1553080525" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1553080525" rel="stylesheet">
    <link href="/css/hybrid.css?1553080525" rel="stylesheet">
    <link href="/css/featherlight.min.css?1553080525" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1553080525" rel="stylesheet">
    <link href="/css/auto-complete.css?1553080525" rel="stylesheet">
    <link href="/css/theme.css?1553080525" rel="stylesheet">
    <link href="/css/hugo-theme.css?1553080525" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1553080525"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/demos/actuators/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="">
    <svg x="0px" y="0px" width="50%" height="100%" viewBox="0 0 291.93 68.4" xmlns="http://www.w3.org/2000/svg">
        <g class="cls-1">
        <path style="fill:#008775;" d="M131.51,61.59H121.14v-10h10.37v10Zm0,57.21h-10.4V69h10.4V118.8Z" transform="translate(-66.72 -51.56)"></path>
        <path style="fill:#008775;" d="M191.48,69L177,112c-2.49,7-6.92,7.94-10.52,7.94-5.33,0-8.54-2.45-10.44-7.93L144,76.27h-4.77V69h12.45l12.44,40c0.54,1.71.88,2.73,2.39,2.73s1.88-1,2.38-2.73l12.69-40h9.92Z" transform="translate(-66.72 -51.56)"></path>
        <path style="fill:#008775;" d="M217.08,69c13.45,0,22.83,8.87,22.83,21.59v7.83c0,12.7-9.38,21.59-22.83,21.59s-22.84-8.89-22.84-21.59V90.54c0-12.71,9.4-21.59,22.84-21.59m0,42.8c8,0,13-6.08,13-13.38V90.54c0-7.3-4.94-13.39-13-13.39-8.52,0-13,6.08-13,13.39v7.83c0,7.3,4.7,13.38,13,13.38" transform="translate(-66.72 -51.56)"></path>
        <path style="fill:#008775;" d="M322.9,70.55a88.57,88.57,0,0,0-19.25-2.3c-13.65,0-22.12,8.61-22.12,22.48v5.46c0,13.86,8.47,22.6,22.12,22.6,0.32,0,2.74,0,3.85-.1v-8.37c-0.42,0-3.54.11-3.85,0.11-7.42,0-12.42-5.72-12.42-14.24V90.73c0-8.52,5-14.24,12.42-14.24a72.93,72.93,0,0,1,10.18.64l0.56,0.12V118.8h10.39V72.27c0-.89,0-1.23-1.89-1.73" transform="translate(-66.72 -51.56)"></path>
        <rect style="fill:#008775;" height="67.24" width="10.39" x="268.07"></rect>
        <path style="fill:#008775;" d="M85,51.56H66.72v67.23H77.53V60.91h6.34c1.35,0,2.49.07,3.64,0.09,9.37,0.18,14,3.9,14,11.18,0,0.29,0,.49,0,0.79,0,6.74-3.7,11.21-13.92,11.21-1,0-2,0-3,0,0,2.58,0,7.36,0,9,1.05,0.05,2,.09,3.05.09,14.66,0,25-5.76,25-20.23,0-.28,0-0.58,0-0.87,0-15-11.28-20.64-27.61-20.64" transform="translate(-66.72 -51.56)"></path>
        <path style="fill:#008775;" d="M258.37,58.21V69h16.93V77H258.37v29c0,4.56,2.91,4.68,7.13,4.68h9.8v8.06H262c-9.81,0-14.18-3.93-14.18-12.74V59.65Z" transform="translate(-66.72 -51.56)"></path>
        </g>
        <path style="fill:#008775;" d="M350,114.44a4.34,4.34,0,1,1,4.34,4.36A4.36,4.36,0,0,1,350,114.44Zm4.35-3.75a3.73,3.73,0,1,0,3.71,3.73A3.73,3.73,0,0,0,354.31,110.7Zm-1,6.05h-0.5V112h1.33c1.2,0,1.78.55,1.78,1.43a1.39,1.39,0,0,1-1,1.35l1.22,1.95h-0.6l-1.13-1.83-1.13.07v1.76Zm0.85-2.24a1.09,1.09,0,0,0,1.26-1c0-.67-0.42-1-1.33-1h-0.8v2.07Z" transform="translate(-66.72 -51.56)"></path>
    </svg>
    <p>PLATFORM ARCHITECTURE</p>
  </a>
  
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-close"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1553080525"></script>
<script type="text/javascript" src="/js/auto-complete.js?1553080525"></script>
<script type="text/javascript">
    
        var baseurl = "";
    
</script>
<script type="text/javascript" src="/js/search.js?1553080525"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics" id="yup">

        
          
          


 
  
    
    <li data-nav-id="/workshop/" title="Steeltoe Cloud Native .NET Microservices Workshop  Workshop" class="dd-item 
        
        
        
        ">
      <a href="/workshop/">
          Steeltoe Cloud Native .NET Microservices Workshop  Workshop
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/concepts/" title="Concepts" class="dd-item 
        
        
        
        ">
      <a href="/concepts/">
          Concepts
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/concepts/advanced-steeltoe/" title="" class="dd-item ">
        <a href="/concepts/advanced-steeltoe/">
        Advanced Features of Steeltoe
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/demos/" title="Demos" class="dd-item 
        parent
        
        
        ">
      <a href="/demos/">
          Demos
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/demos/intro-creds/" title="" class="dd-item ">
        <a href="/demos/intro-creds/">
        Introduction &amp; Credentials
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/setup-environment/" title="" class="dd-item ">
        <a href="/demos/setup-environment/">
        Setup Environment
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/env-vars/" title="" class="dd-item ">
        <a href="/demos/env-vars/">
        Environment Variables
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/cups/" title="" class="dd-item ">
        <a href="/demos/cups/">
        User Provided Services with Steeltoe
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/actuators/" title="" class="dd-item active">
        <a href="/demos/actuators/">
        Include Steeltoe Actuators and Create a Custom Health Check
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/push-microservice/" title="" class="dd-item ">
        <a href="/demos/push-microservice/">
        Push Microservice to PASW
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/using-actuators/" title="" class="dd-item ">
        <a href="/demos/using-actuators/">
        App Manager with Management Actuators
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/logging/" title="" class="dd-item ">
        <a href="/demos/logging/">
        Steeltoe Dynamic Logging
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/next-steps/" title="" class="dd-item ">
        <a href="/demos/next-steps/">
        Continuing Your .NET Cloud Native Journey
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/demos/actuators/" selected>English</option>
                    
                  
              
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
              
                  
                    
                    
                      <option id="es" value="/es/demos/actuators/">Español</option>
                    
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="fr" value="/fr/demos/actuators/">Français</option>
                    
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
                    
                    
                      <option id="pt" value="/pt/demos/actuators/">Português</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
      </ul>
    </section>
    
    <section id="footer">
      <p>Built with <i class="fas fa-heart"></i></a> by <a href="https://pivotal.io">Pivotal</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Pivotal Workshop</a> > <a href='/demos/'>Demos</a> > 
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li><a href="#include-steeltoe-actuators-and-create-a-custom-health-check">Include Steeltoe Actuators and Create a Custom Health Check</a>
<ul>
<li><a href="#goal">Goal</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#add-steeltoe-management-actuators-to-the-app">Add Steeltoe Management Actuators to the app</a></li>
<li><a href="#extend-app-health-check-to-include-a-custom-check">Extend app health check to include a custom check</a></li>
<li><a href="#complete">Complete</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1></h1>
          

        




<h1 id="include-steeltoe-actuators-and-create-a-custom-health-check">Include Steeltoe Actuators and Create a Custom Health Check</h1>

<h2 id="goal">Goal</h2>

<p>Assuming you have already pushed an app based on the Steeltoe Cloud Foundry templates, this lab will review what additions were made in the project to enable Actuators and the automatic benefits in App Manager.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li>Visual Studio (min 2015)</li>
<li>Internet Access</li>
<li>Web Browser (Chrome, Firefox, Edge, Safari)(Not Internet Explorer)</li>
</ul>

<h2 id="add-steeltoe-management-actuators-to-the-app">Add Steeltoe Management Actuators to the app</h2>

<ol>
<li><p>Open the <code>Startup.cs</code> file by double clicking.</p></li>

<li><p>Confirm the Management package is implemented.</p>

<pre><code class="language-cs">using Steeltoe.Management.CloudFoundry;
</code></pre></li>

<li><p>In the <code>ConfigureServices</code> method, confirm the default actuator endpoints have been initialized.</p>

<pre><code class="language-cs">public void ConfigureServices(IServiceCollection services) {
    services.AddCloudFoundryActuators(Configuration);

    ...
}
</code></pre></li>

<li><p>In the <code>Configure</code> method, confirm the default actuator endpoints have been implemented.</p>

<pre><code class="language-cs">public void Configure(IApplicationBuilder app,
        IHostingEnvironment env,
        ILoggerFactory loggerFactory) {

    app.UseCloudFoundryActuators();
    app.UseMvc();
     ...
}
</code></pre></li>

<li><p>Now say to yourself &ldquo;wow that was easy&rdquo;, because thats all you need to do, to get the default actuators going! To lean more about what is included in the default endpoints, have a look at the <a href="https://steeltoe.io/docs/steeltoe-management/#1-2-usage">Steeltoe management usage documentation</a>.</p></li>
</ol>

<h2 id="extend-app-health-check-to-include-a-custom-check">Extend app health check to include a custom check</h2>

<p>Before we switch to App Manager and see all the wonderful benefits of actuators, let&rsquo;s customize things a little. One very useful actuator is the /health endpoint. This helps BOSH determine an app&rsquo;s health and weather it needs to be recycled. Lets extend the default health check to include a custom check.</p>

<ol>
<li><p>Create a new C# class in the app project, named <code>CustomHealthContributor.cs</code>. It can be located in the root of the project with the Project.cs and Statup.cs files.</p></li>

<li><p>If Visual Studio did not automatically open the new file, do so by by double clicking.</p></li>

<li><p>Add a reference to the HealthChecks package.</p>

<pre><code class="language-cs">using Steeltoe.Common.HealthChecks;
</code></pre></li>

<li><p>Extend the CustomHealthContributor class with the IHealthCheckContributor.</p>

<pre><code class="language-cs">...

public class CustomHealthContributor : IHealthContributor {
    ...

</code></pre></li>

<li><p>Within the class add a public Id property and add the Health method with some very basic status reporting.</p>

<pre><code class="language-cs">public string Id =&gt; &quot;CustomHealthContributor&quot;;

public HealthCheckResult Health(){
        var result = new HealthCheckResult {
                Status = HealthStatus.UP,
                Description = &quot;This health check does not check anything, yet!&quot;
        };

        result.Details.Add(&quot;status&quot;, HealthStatus.UP.ToString()); //a part of the middleware response
        return result;
}
</code></pre></li>

<li><p>Your <code>CustomHealthContributor</code> class should look like the following. Not the check isn&rsquo;t actually checking anything at the moment. It&rsquo;s just an example :).</p>

<pre><code class="language-cs">public class CustomHealthContributor : IHealthContributor {
public string Id =&gt; &quot;CustomHealthContributor&quot;;

public HealthCheckResult Health()
{
    var result = new HealthCheckResult {
        // this is used as part of the aggregate, it is not directly part of the middleware response
        Status = HealthStatus.UP,
        Description = &quot;This health check does not check anything&quot;
    };
    result.Details.Add(&quot;status&quot;, HealthStatus.UP.ToString());
    return result;
}
}
</code></pre></li>

<li><p>Open the <code>Startup.cs</code> file, by double clicking.</p></li>

<li><p>Add a reference to the HealthChecks Steeltoe package.</p>

<pre><code class="language-cs">using Steeltoe.Common.HealthChecks;
</code></pre></li>

<li><p>In the <code>ConfigureServices</code> method, register the new custom health check as a singleton.</p>

<pre><code class="language-cs">public void ConfigureServices(IServiceCollection services)
{
    ...

    services.AddSingleton&lt;IHealthContributor, CustomHealthContributor&gt;();
}
</code></pre></li>
</ol>

<h2 id="complete">Complete</h2>

<p>Along with the default Cloud Foundry health checks, we have added in the possibility to report an additional check on some custom serivce or object. You can read more about what healthchecks are built in, in the <a href="https://steeltoe.io/docs/steeltoe-management/#1-2-3-health">Steeltoe health documentation</a>.</p>

<p>Next up, push the app to the foundation and explore all the cool things that get enabled in App Manager.</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/demos/cups/" title=""> <i class="fas fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/demos/push-microservice/" title="" style="margin-right: 0px;"><i class="fas fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1553080525"></script>
    <script src="/js/perfect-scrollbar.min.js?1553080525"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1553080525"></script>
    <script src="/js/jquery.sticky.js?1553080525"></script>
    <script src="/js/featherlight.min.js?1553080525"></script>
    <script src="/js/html5shiv-printshiv.min.js?1553080525"></script>
    <script src="/js/highlight.pack.js?1553080525"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1553080525"></script>
    <script src="/js/learn.js?1553080525"></script>
    <script src="/js/hugo-learn.js?1553080525"></script>

    <link href="/mermaid/mermaid.css?1553080525" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1553080525"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-129674067-1', 'auto');
    ga('send', 'pageview');
  
</script>

  </body>
</html>

