<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.52-DEV" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />
    <title> :: Pivotal Workshop</title>

    
    <link href="/css/nucleus.css?1553080418" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1553080418" rel="stylesheet">
    <link href="/css/hybrid.css?1553080418" rel="stylesheet">
    <link href="/css/featherlight.min.css?1553080418" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1553080418" rel="stylesheet">
    <link href="/css/auto-complete.css?1553080418" rel="stylesheet">
    <link href="/css/theme.css?1553080418" rel="stylesheet">
    <link href="/css/hugo-theme.css?1553080418" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1553080418"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/demos/4_service_discovery/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="">
    <svg x="0px" y="0px" width="50%" height="100%" viewBox="0 0 291.93 68.4" xmlns="http://www.w3.org/2000/svg">
        <g class="cls-1">
        <path style="fill:#008775;" d="M131.51,61.59H121.14v-10h10.37v10Zm0,57.21h-10.4V69h10.4V118.8Z" transform="translate(-66.72 -51.56)"></path>
        <path style="fill:#008775;" d="M191.48,69L177,112c-2.49,7-6.92,7.94-10.52,7.94-5.33,0-8.54-2.45-10.44-7.93L144,76.27h-4.77V69h12.45l12.44,40c0.54,1.71.88,2.73,2.39,2.73s1.88-1,2.38-2.73l12.69-40h9.92Z" transform="translate(-66.72 -51.56)"></path>
        <path style="fill:#008775;" d="M217.08,69c13.45,0,22.83,8.87,22.83,21.59v7.83c0,12.7-9.38,21.59-22.83,21.59s-22.84-8.89-22.84-21.59V90.54c0-12.71,9.4-21.59,22.84-21.59m0,42.8c8,0,13-6.08,13-13.38V90.54c0-7.3-4.94-13.39-13-13.39-8.52,0-13,6.08-13,13.39v7.83c0,7.3,4.7,13.38,13,13.38" transform="translate(-66.72 -51.56)"></path>
        <path style="fill:#008775;" d="M322.9,70.55a88.57,88.57,0,0,0-19.25-2.3c-13.65,0-22.12,8.61-22.12,22.48v5.46c0,13.86,8.47,22.6,22.12,22.6,0.32,0,2.74,0,3.85-.1v-8.37c-0.42,0-3.54.11-3.85,0.11-7.42,0-12.42-5.72-12.42-14.24V90.73c0-8.52,5-14.24,12.42-14.24a72.93,72.93,0,0,1,10.18.64l0.56,0.12V118.8h10.39V72.27c0-.89,0-1.23-1.89-1.73" transform="translate(-66.72 -51.56)"></path>
        <rect style="fill:#008775;" height="67.24" width="10.39" x="268.07"></rect>
        <path style="fill:#008775;" d="M85,51.56H66.72v67.23H77.53V60.91h6.34c1.35,0,2.49.07,3.64,0.09,9.37,0.18,14,3.9,14,11.18,0,0.29,0,.49,0,0.79,0,6.74-3.7,11.21-13.92,11.21-1,0-2,0-3,0,0,2.58,0,7.36,0,9,1.05,0.05,2,.09,3.05.09,14.66,0,25-5.76,25-20.23,0-.28,0-0.58,0-0.87,0-15-11.28-20.64-27.61-20.64" transform="translate(-66.72 -51.56)"></path>
        <path style="fill:#008775;" d="M258.37,58.21V69h16.93V77H258.37v29c0,4.56,2.91,4.68,7.13,4.68h9.8v8.06H262c-9.81,0-14.18-3.93-14.18-12.74V59.65Z" transform="translate(-66.72 -51.56)"></path>
        </g>
        <path style="fill:#008775;" d="M350,114.44a4.34,4.34,0,1,1,4.34,4.36A4.36,4.36,0,0,1,350,114.44Zm4.35-3.75a3.73,3.73,0,1,0,3.71,3.73A3.73,3.73,0,0,0,354.31,110.7Zm-1,6.05h-0.5V112h1.33c1.2,0,1.78.55,1.78,1.43a1.39,1.39,0,0,1-1,1.35l1.22,1.95h-0.6l-1.13-1.83-1.13.07v1.76Zm0.85-2.24a1.09,1.09,0,0,0,1.26-1c0-.67-0.42-1-1.33-1h-0.8v2.07Z" transform="translate(-66.72 -51.56)"></path>
    </svg>
    <p>PLATFORM ARCHITECTURE</p>
  </a>
  
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-close"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1553080418"></script>
<script type="text/javascript" src="/js/auto-complete.js?1553080418"></script>
<script type="text/javascript">
    
        var baseurl = "";
    
</script>
<script type="text/javascript" src="/js/search.js?1553080418"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics" id="yup">

        
          
          


 
  
    
    <li data-nav-id="/workshop/" title="Advanced Steeltoe Workshop Workshop" class="dd-item 
        
        
        
        ">
      <a href="/workshop/">
          Advanced Steeltoe Workshop Workshop
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/concepts/" title="Concepts" class="dd-item 
        
        
        
        ">
      <a href="/concepts/">
          Concepts
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/concepts/slides/" title="" class="dd-item ">
        <a href="/concepts/slides/">
        deck
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/demos/" title="Demos" class="dd-item 
        parent
        
        
        ">
      <a href="/demos/">
          Demos
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/demos/1_overview/" title="" class="dd-item ">
        <a href="/demos/1_overview/">
        1. Overview
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/2_basic-push/" title="" class="dd-item ">
        <a href="/demos/2_basic-push/">
        2. Basic Push
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/3_database/" title="" class="dd-item ">
        <a href="/demos/3_database/">
        3. Database
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/4_service_discovery/" title="" class="dd-item active">
        <a href="/demos/4_service_discovery/">
        4. Service Discovery
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/5_config_server/" title="" class="dd-item ">
        <a href="/demos/5_config_server/">
        5. Config Server
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/6_hystrix/" title="" class="dd-item ">
        <a href="/demos/6_hystrix/">
        6. Hystrix
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/7_actuators_tracing_and_metrics/" title="" class="dd-item ">
        <a href="/demos/7_actuators_tracing_and_metrics/">
        7. Actuators, Tracing &amp; Metrics
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/8_security/" title="" class="dd-item ">
        <a href="/demos/8_security/">
        8. Security
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/demos/4_service_discovery/" selected>English</option>
                    
                  
              
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
              
                  
                    
                    
                      <option id="es" value="/es/demos/4_service_discovery/">Español</option>
                    
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="fr" value="/fr/demos/4_service_discovery/">Français</option>
                    
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
                    
                    
                      <option id="pt" value="/pt/demos/4_service_discovery/">Português</option>
                    
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
      </ul>
    </section>
    
    <section id="footer">
      <p>Built with <i class="fas fa-heart"></i></a> by <a href="https://pivotal.io">Pivotal</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Pivotal Workshop</a> > <a href='/demos/'>Demos</a> > 
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#service-discovery">Service Discovery</a>
<ul>
<li><a href="#service-discovery-locally">Service discovery locally</a></li>
<li><a href="#service-discovery-on-pcf">Service discovery on PCF</a></li>
<li><a href="#things-to-highlight-in-code">Things to highlight in code</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1></h1>
          

        




<h2 id="service-discovery">Service Discovery</h2>

<h3 id="service-discovery-locally">Service discovery locally</h3>

<ol>
<li><p>Pull down docker image.</p>

<pre><code> &gt; docker pull mayan31370/spring-eureka
</code></pre></li>

<li><p>Run it.</p>

<pre><code> &gt; docker run -d --name eureka -p 8761:8080/tcp mayan31370/spring-eureka
</code></pre></li>

<li><p>Launch FunnyQuotesLegacyService or FunnyQuotesServicesOwin from Visual Studio.</p></li>

<li><p>Check the dashboard <a href="http://localhost:8761/">http://localhost:8761/</a> to confirm registration.</p></li>

<li><p>For FunnyQuotesLegacyService, append /FunnyQuoteServiceLegacy.asmx/GetCookie to the url to observe the result.</p></li>

<li><p>For FunnyQuotesServicesOwin, append /funnyquotes/random to the url to observe the result.</p></li>
</ol>

<h3 id="service-discovery-on-pcf">Service discovery on PCF</h3>

<ol>
<li>Provision the p-service-registry service, the standard plan, and name it &ldquo;eureka&rdquo;.</li>
<li>Bind it to FunnyQuotesLegacyService &amp; FunnyQuoteServicesOwin. Restart both.</li>
<li>Navigate to service dashboard.

<ol>
<li>Apps Manager &gt; Space &gt; Services &gt; Eureka &gt; Manage.</li>
</ol></li>
<li>Confirm both apps are showing up in the registry.</li>
</ol>

<p>Explain how we can now resolve the URL endpoint by well known name.</p>

<h3 id="things-to-highlight-in-code">Things to highlight in code</h3>

<ol>
<li>Open appsettings.json.

<ol>
<li>Explain <code>eureka:client</code> section when running locally.</li>
<li>This will be overriden when running on CloudFoundry.</li>
</ol></li>
<li>Open Startup.cs

<ol>
<li>The line, <code>services.AddDiscoveryClient(Configuration);</code> is used to register services to be discovered.</li>
<li>The line, <code>.AddHttpMessageHandler&lt;DiscoveryHttpMessageHandler&gt;();</code> is to build up the HttpClient factory.</li>
<li>The line, <code>app.UseDiscoveryClient();</code> makes discovery ready for use.</li>
<li>Explain the use of HttpClientFactory (new in ASP.NET Core 2.1). Article explaining why it should be used instead of using HttpClient by hand <a href="https://www.stevejgordon.co.uk/introduction-to-httpclientfactory-aspnetcore">https://www.stevejgordon.co.uk/introduction-to-httpclientfactory-aspnetcore</a>.</li>
</ol></li>
</ol>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/demos/3_database/" title=""> <i class="fas fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/demos/5_config_server/" title="" style="margin-right: 0px;"><i class="fas fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1553080418"></script>
    <script src="/js/perfect-scrollbar.min.js?1553080418"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1553080418"></script>
    <script src="/js/jquery.sticky.js?1553080418"></script>
    <script src="/js/featherlight.min.js?1553080418"></script>
    <script src="/js/html5shiv-printshiv.min.js?1553080418"></script>
    <script src="/js/highlight.pack.js?1553080418"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1553080418"></script>
    <script src="/js/learn.js?1553080418"></script>
    <script src="/js/hugo-learn.js?1553080418"></script>

    <link href="/mermaid/mermaid.css?1553080418" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1553080418"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-129674067-1', 'auto');
    ga('send', 'pageview');
  
</script>

  </body>
</html>

